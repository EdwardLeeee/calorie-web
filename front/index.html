<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>每日卡路里紀錄 (Vue 前端)</title>

  <!-- 載入自訂 CSS -->
  <link rel="stylesheet" href="styles.css" />

  <!-- 載入 Vue 3、Vue Router 4、Axios -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://unpkg.com/vue-router@4/dist/vue-router.global.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

  <!-- 防止瀏覽器快取 -->
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
</head>
<body>
  <!-- 1. App Header（固定顯示） -->
  <header class="app-header">
    <h1>每日卡路里紀錄</h1>
  </header>

  <!-- 2. Vue 掛載點，router-view 會動態放置各頁面 -->
  <div id="app">
    <router-view></router-view>
  </div>

  <!-- -------------------- 以下為各組件模板 -------------------- -->

  <!-- A. Login 組件模板 （如無需修改請保持原有，這裡略過） -->
  <template id="login-template">
    <!-- 省略，與之前一樣… -->
  </template>

  <!-- B. Signup 組件模板 -->
  <template id="signup-template">
    <!-- 省略，與之前一樣… -->
  </template>

  <!-- C. Dashboard（首頁）組件模板 -->
  <template id="dashboard-template">
    <div class="dashboard-container">
      <!-- 1. 日期與星期列 -->
      <div class="date-header">
        <div class="today-date">{{ todayFormatted }}</div>
        <div class="weekday-row">
          <div
            v-for="(d, idx) in weekdays"
            :key="idx"
            class="weekday-item"
          >
            <!-- 用圓點 + 底線 標示今天 -->
            <span 
              :class="['weekday-text', { 'is-today': idx === todayIndex }]"
            >
              {{ d }}
            </span>
            <span v-if="idx === todayIndex" class="dot"></span>
            <div v-if="idx === todayIndex" class="underline"></div>
          </div>
        </div>
      </div>

      <!-- 2. 水球（圓形進度 + 總熱量） -->
      <div class="waterball-container">
        <svg viewBox="0 0 120 120" class="waterball-svg">
          <!-- 底圈 -->
          <circle
            cx="60" cy="60" r="54"
            stroke="#e0f0e0" stroke-width="12" fill="none"
          />
          <!-- 進度圈 -->
          <circle
            cx="60" cy="60" r="54"
            :stroke="progressColor"
            stroke-width="12"
            fill="none"
            stroke-linecap="round"
            :stroke-dasharray="circumference"
            :stroke-dashoffset="circumference - (calorieRatio * circumference)"
            transform="rotate(-90 60 60)"
          />
          <!-- 中心數字 -->
          <text x="60" y="68" text-anchor="middle" class="waterball-text">
            {{ todayCalories }} kcal
          </text>
        </svg>
      </div>

      <!-- 3. 今日飲食紀錄列表 (白色框) -->
      <div class="today-records-card">
        <h3>今天的飲食紀錄</h3>
        <div v-if="todayRecords.length">
          <ul class="record-list">
            <li v-for="r in todayRecords" :key="r.id" class="record-item">
              <!-- 顯示時間 + 各數值 -->
              <span class="record-time">
                {{ formatDateTime(r.record_time) }}
              </span>
              <span class="record-detail">
                {{ r.calorie_sum }} kcal,
                {{ r.carb_sum }} g 碳水,
                {{ r.protein_sum }} g 蛋白,
                {{ r.fat_sum }} g 脂肪
                <span v-if="r.custom_food_id"> (自訂ID: {{ r.custom_food_id }})</span>
                <span v-else-if="r.official_food_id"> (官方ID: {{ r.official_food_id }})</span>
              </span>
            </li>
          </ul>
        </div>
        <div v-else class="no-data">
          <p>今天尚無紀錄</p>
        </div>
        <button class="btn link-btn" @click="goToAllRecords">查看更多</button>
      </div>

      <!-- 4. 底部導航列 -->
      <nav class="bottom-nav">
        <div 
          class="nav-item" 
          :class="{ active: true }"
        >
          飲食紀錄
        </div>
        <div 
          class="nav-item" 
          @click="goToCustomFoods"
        >
          自訂食物
        </div>
      </nav>
    </div>
  </template>

  <!-- D. All Records（完整列表）組件模板 -->
  <template id="all-records-template">
    <div class="all-records-container">
      <div class="all-records-header">
        <button class="btn link-btn" @click="$router.back()">← 返回</button>
        <h2>全部飲食紀錄</h2>
      </div>
      <div v-if="records.length">
        <ul class="all-records-list">
          <li v-for="r in records" :key="r.id" class="record-item">
            <span class="record-time">{{ formatDateTime(r.record_time) }}</span>
            <span class="record-detail">
              {{ r.calorie_sum }} kcal,
              {{ r.carb_sum }} g 碳水,
              {{ r.protein_sum }} g 蛋白,
              {{ r.fat_sum }} g 脂肪
              <span v-if="r.custom_food_id"> (自訂ID: {{ r.custom_food_id }})</span>
              <span v-else-if="r.official_food_id"> (官方ID: {{ r.official_food_id }})</span>
            </span>
          </li>
        </ul>
      </div>
      <div v-else class="no-data"><p>目前沒有任何紀錄</p></div>
      <nav class="bottom-nav">
        <div class="nav-item" @click="$router.push('/')">飲食紀錄</div>
        <div class="nav-item" @click="$router.push('/custom-foods')">自訂食物</div>
      </nav>
    </div>
  </template>

  <!-- E. Custom Foods（自訂食物）組件模板 -->
  <template id="custom-foods-template">
    <div class="custom-foods-container">
      <div class="all-records-header">
        <button class="btn link-btn" @click="$router.back()">← 返回</button>
        <h2>自訂食物</h2>
        <button class="btn primary" @click="goToAddFood">新增食物</button>
      </div>
      <div v-if="foods.length">
        <ul class="custom-food-list">
          <li v-for="f in foods" :key="f.id" class="food-item">
            <span class="food-name">{{ f.name }}</span>
            <span class="food-detail">
              {{ f.calories }} kcal,
              {{ f.protein }} g 蛋白,
              {{ f.fat }} g 脂肪,
              {{ f.carbs }} g 碳水
            </span>
          </li>
        </ul>
      </div>
      <div v-else class="no-data"><p>目前尚無自訂食物</p></div>
      <nav class="bottom-nav">
        <div class="nav-item" @click="$router.push('/')">飲食紀錄</div>
        <div class="nav-item active">自訂食物</div>
      </nav>
    </div>
  </template>

  <!-- F. Add Food（新增自訂食物）組件模板 -->
  <template id="add-food-template">
    <div class="custom-foods-container">
      <div class="all-records-header">
        <button class="btn link-btn" @click="$router.back()">← 返回</button>
        <h2>新增自訂食物</h2>
      </div>
      <div class="form-card">
        <form @submit.prevent="submitFood" autocomplete="off">
          <div class="form-group">
            <label for="name">名稱</label>
            <input 
              id="name" 
              v-model="form.name" 
              type="text" 
              required 
              placeholder="食物名稱" 
            />
          </div>
          <div class="form-group">
            <label for="calories">卡路里 (kcal)</label>
            <input 
              id="calories" 
              v-model.number="form.calories" 
              type="number" 
              step="0.01" 
              required 
              placeholder="例如：150" 
            />
          </div>
          <div class="form-group">
            <label for="protein">蛋白質 (g)</label>
            <input 
              id="protein" 
              v-model.number="form.protein" 
              type="number" 
              step="0.01" 
              required 
              placeholder="例如：10" 
            />
          </div>
          <div class="form-group">
            <label for="fat">脂肪 (g)</label>
            <input 
              id="fat" 
              v-model.number="form.fat" 
              type="number" 
              step="0.01" 
              required 
              placeholder="例如：5" 
            />
          </div>
          <div class="form-group">
            <label for="carbs">碳水 (g)</label>
            <input 
              id="carbs" 
              v-model.number="form.carbs" 
              type="number" 
              step="0.01" 
              required 
              placeholder="例如：20" 
            />
          </div>
          <div class="form-actions">
            <button class="btn primary">送出</button>
          </div>
        </form>
      </div>
      <div v-if="error" class="error">{{ error }}</div>
      <nav class="bottom-nav">
        <div class="nav-item" @click="$router.push('/')">飲食紀錄</div>
        <div class="nav-item active">自訂食物</div>
      </nav>
    </div>
  </template>

  <!-- 最後載入 Vue 邏輯 -->
  <script src="app.js"></script>
</body>
</html>

