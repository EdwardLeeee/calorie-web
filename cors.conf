# #############################################################
# # 全域 CORS 設定檔                                          #
# # 處理 OPTIONS 預檢請求和一般請求的 CORS Header             #
# #############################################################

# 處理預檢請求 (Preflight Request)
# 當瀏覽器發送 OPTIONS 請求時，附上所有必要的 CORS Header，然後直接回傳 204 (No Content)。
if ($request_method = 'OPTIONS') {
    add_header 'Access-Control-Allow-Origin' 'https://calorie.oraclelee.com' always;
    add_header 'Access-Control-Allow-Credentials' 'true' always;
    add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS' always;
    add_header 'Access-Control-Allow-Headers' 'DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization' always;
    add_header 'Access-Control-Max-Age' 1728000;
    add_header 'Content-Length' 0;
    return 204;
}

# 處理實際請求 (例如 GET, POST)
# 確保這些請求的回應中也包含必要的 CORS Header。
add_header 'Access-Control-Allow-Origin' 'https://calorie.oraclelee.com' always;
add_header 'Access-Control-Allow-Credentials' 'true' always;
add_header 'Access-Control-Expose-Headers' 'Content-Length,Content-Range' always;
